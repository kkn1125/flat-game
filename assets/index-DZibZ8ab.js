var y=Object.defineProperty;var d=(l,t,i)=>t in l?y(l,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[t]=i;var e=(l,t,i)=>(d(l,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const p=document.getElementById("app"),o=document.createElement("canvas"),h=o.getContext("2d");class c{constructor(t,i,n,s){e(this,"x");e(this,"y");e(this,"width");e(this,"height");const r=innerHeight,a=30;this.x=t,this.y=r-a*i,this.width=n,this.height=a*s}draw(t){h.fillRect(this.x+t,this.y,this.width,this.height)}}class f{constructor(t,i){e(this,"x");e(this,"y");e(this,"width",30);e(this,"height",30);e(this,"velocityX",0);e(this,"velocityY",0);e(this,"speed",3);e(this,"gravity",.5);e(this,"jumpPower",10);e(this,"isJumping",!1);this.x=t,this.y=i}update(t){let i=!0;this.y+this.height+this.velocityY<o.height?this.velocityY+=this.gravity:(this.velocityY=0,i=!1,this.isJumping=!1),i&&(this.isJumping=!0);for(let n=0;n<t.length;n++){const s=t[n];this.checkVerticalCollision(s),this.checkHorizontalCollision(s)}this.x+=this.velocityX,this.y+=this.velocityY,!i&&!this.isJumping&&(this.velocityY=0)}checkVerticalCollision(t){this.y+this.height+this.velocityY>=t.y&&this.y+this.height<=t.y+1&&this.x+this.width+this.velocityX>=t.x&&this.x+this.velocityX<=t.x+t.width&&this.velocityY>0&&(this.velocityY=0,this.y=t.y-this.height,this.isJumping=!1)}checkHorizontalCollision(t){this.isJumping&&this.x+this.width>t.x&&this.x<t.x+t.width||this.y+this.height+this.velocityY>t.y&&this.y+this.height<t.y+t.height&&this.x+this.width+this.velocityX>=t.x&&this.x+this.velocityX<=t.x+t.width&&(this.velocityX>0&&(this.velocityX=0),this.velocityX<0&&(this.velocityX=0))}drawFixed(t){h.fillStyle="blue",h.fillRect(this.x+t,this.y,this.width,this.height)}jump(){this.isJumping||(this.isJumping=!0,this.velocityY=-this.jumpPower)}moveLeft(){this.velocityX=-this.speed}moveRight(){this.velocityX=this.speed}stop(){this.velocityX=0}}class u{constructor(){e(this,"left",!1);e(this,"right",!1);e(this,"up",!1);e(this,"down",!1)}}class m{constructor(){e(this,"player");e(this,"blocks",[]);e(this,"joystick",new u);e(this,"centerX");e(this,"viewLimit");e(this,"mapLimit");e(this,"overflow",0);this.player=new f(100,400),this.bindEvents(),this.blocks.push(new c(100,3,150,1)),this.blocks.push(new c(350,5,150,1)),this.blocks.push(new c(600,7,30,1)),this.blocks.push(new c(760,4,150,1)),this.blocks.push(new c(780,7,50,1)),this.blocks.push(new c(900,10,350,1)),this.blocks.push(new c(730,13,550,1)),this.blocks.push(new c(1e3,5,1e3,1));const t=Math.max(...this.blocks.map(i=>i.x+i.width).toSorted((i,n)=>n-i))+50;this.mapLimit=[50,t],this.viewLimit=[o.width*.45,t-o.width*.45],this.centerX=this.player.x<this.viewLimit[0]?25:this.player.x>this.viewLimit[1]?this.viewLimit[1]-o.width:o.width/2-this.player.x-this.player.width+50}bindEvents(){p.append(o),this.handleResize(),window.addEventListener("resize",this.handleResize.bind(this)),document.addEventListener("keydown",this.handleKeydown.bind(this)),document.addEventListener("keyup",this.handleKeyup.bind(this))}handleKeydown(t){const i=t.key.toLowerCase();i==="arrowleft"&&(this.joystick.left=!0),i==="arrowright"&&(this.joystick.right=!0),i==="arrowup"&&(this.joystick.up=!0),i==="arrowdown"&&(this.joystick.down=!0)}handleKeyup(t){const i=t.key.toLowerCase();i==="arrowleft"&&(this.joystick.left=!1),i==="arrowright"&&(this.joystick.right=!1),i==="arrowup"&&(this.joystick.up=!1),i==="arrowdown"&&(this.joystick.down=!1)}handleResize(){console.log("resize"),o.width=innerWidth,o.height=innerHeight}update(){this.mapLimit[0]<this.player.x&&this.joystick.left&&this.player.moveLeft(),this.mapLimit[1]>this.player.x+this.player.width&&this.joystick.right&&this.player.moveRight(),this.joystick.up&&this.player.jump(),this.viewLimit[0]<this.player.x+this.player.velocityX&&(this.centerX-=this.player.velocityX),this.player.x+this.player.width+this.player.velocityX>this.viewLimit[1]&&(this.centerX+=this.player.velocityX),this.player.update(this.blocks),(this.joystick.left||this.joystick.right)&&this.player.stop()}draw(){h.clearRect(0,0,o.width,o.height);for(let t=0;t<this.blocks.length;t++)this.blocks[t].draw(this.centerX);this.player.drawFixed(this.centerX),h.strokeStyle="#ccc",h.textAlign="left",h.fillText("< left limit",this.mapLimit[0]+this.centerX,o.height/2),h.beginPath(),h.moveTo(this.mapLimit[0]+this.centerX,0),h.lineTo(this.mapLimit[0]+this.centerX,o.height+0),h.stroke(),h.textAlign="right",h.fillText("right limit >",this.mapLimit[1]+this.centerX,o.height/2),h.beginPath(),h.moveTo(this.mapLimit[1]+this.centerX,0),h.lineTo(this.mapLimit[1]+this.centerX,o.height+0),h.stroke()}run(){requestAnimationFrame(()=>this.run()),this.update(),this.draw()}}const w=new m;w.run();
